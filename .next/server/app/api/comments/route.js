"use strict";(()=>{var e={};e.id=13,e.ids=[13],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},63485:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>b,requestAsyncStorage:()=>I,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>f,POST:()=>h});var i=r(49303),s=r(88716),o=r(60670),a=r(53524),u=r(87070),l=r(13538),d=r(95456),m=r(1184),p=r(96263);function c(e,t=400,r){return u.NextResponse.json({error:e,details:r},{status:t})}async function f(e){let{searchParams:t}=new URL(e.url),r=t.get("storyId"),n=t.get("projectId"),i=t.get("submissionId"),s=Number.parseInt(t.get("limit")??"",10);if([r,n,i].filter(Boolean).length>1)return c("Specify at most one target when listing comments.");let o=await l.Z.comment.findMany({where:r?{storyId:r}:n?{projectId:n}:i?{submissionId:i}:{},include:{author:{select:{id:!0,username:!0,name:!0,avatarUrl:!0}}},orderBy:{createdAt:"desc"},take:Number.isFinite(s)?Math.min(Math.max(s,1),200):50});return u.NextResponse.json({data:o,meta:{total:o.length}})}async function h(e){let t;try{let r=await e.json();t=(0,m.Kl)(r)}catch(e){if(e instanceof p.jmq)return c("Invalid comment payload.",422,e.flatten());return c("Malformed JSON body.")}let r=await (0,d.ts)(),n=t.authorId??r?.id??null;if(!n)return c("Authentication required.",401);if(t.authorId&&r?.id&&t.authorId!==r.id)return c("You cannot submit comments for another user.",403);let[i,s]=await Promise.all([l.Z.user.findUnique({where:{id:n}}),g(t)]);if(!i)return c("Author not found.",404);if(!s)return c("Target resource not found.",404);try{let e=await l.Z.comment.create({data:{authorId:n,body:t.body,storyId:t.storyId,projectId:t.projectId,submissionId:t.submissionId},include:{author:{select:{id:!0,username:!0,name:!0,avatarUrl:!0}}}});return u.NextResponse.json({data:e},{status:201})}catch(e){if(e instanceof a.Prisma.PrismaClientKnownRequestError)return c(e.message,400);throw e}}async function g(e){return e.storyId?!!await l.Z.story.findUnique({where:{id:e.storyId}}):e.projectId?!!await l.Z.project.findUnique({where:{id:e.projectId}}):!!e.submissionId&&!!await l.Z.submission.findUnique({where:{id:e.submissionId}})}let y=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/comments/route",pathname:"/api/comments",filename:"route",bundlePath:"app/api/comments/route"},resolvedPagePath:"C:\\Users\\pc\\OneDrive\\Desktop\\forth.studio\\src\\app\\api\\comments\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:I,staticGenerationAsyncStorage:w,serverHooks:x}=y,q="/api/comments/route";function b(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:w})}},95456:(e,t,r)=>{r.d(t,{Lz:()=>u,ts:()=>d}),r(6113);var n=r(13539),i=r(53797),s=r(98691),o=r(75571),a=r(13538);let u={adapter:(0,n.N)(a.Z),session:{strategy:"database"},secret:function(){let e=process.env.NEXTAUTH_SECRET;if(!e)throw Error("NEXTAUTH_SECRET is required in production environments.");return e}(),pages:{signIn:"/auth/sign-in"},providers:[(0,i.Z)({name:"Email and password",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e.password)return null;let t=await a.Z.user.findUnique({where:{email:e.email.toLowerCase()}});return t&&await (0,s.qu)(e.password,t.hashedPassword)?{id:t.id,email:t.email,name:t.name??t.username,image:t.avatarUrl??null}:null}})],callbacks:{async session({session:e,user:t}){if(!e.user)return e;let r=t??(e.user.email?await a.Z.user.findUnique({where:{email:e.user.email.toLowerCase()},select:{id:!0,name:!0,username:!0,email:!0,avatarUrl:!0}}):null);return r&&(e.user={...e.user,id:r.id}),e}}};async function l(){return(0,o.getServerSession)(u)}async function d(){let e=await l();return e?.user??null}},13538:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(53524);let i=globalThis.prisma??new n.PrismaClient({log:["error"]})},1184:(e,t,r)=>{r.d(t,{Kl:()=>l,VO:()=>m,Wi:()=>d});var n=r(96263);let i=()=>n.Z_8().cuid({message:"Invalid identifier"});function s(e,t){let r=[t.storyId?"storyId":null,t.projectId?"projectId":null,t.submissionId?"submissionId":null].filter(Boolean);0===r.length?e.addIssue({code:n.NLt.custom,message:"Specify exactly one target resource."}):r.length>1&&e.addIssue({code:n.NLt.custom,message:`Multiple targets provided (${r.join(", ")}). Select only one.`})}let o=n.Ryn({authorId:i().optional(),body:n.Z_8().trim().min(3,"Comment is too short.").max(2e3),storyId:i().optional(),projectId:i().optional(),submissionId:i().optional()}).superRefine((e,t)=>s(t,e)),a=n.Ryn({userId:i().optional(),problemSlug:n.Z_8().trim().min(1,"Problem slug is required."),language:n.Z_8().trim().min(1,"Language is required."),code:n.Z_8().min(10,"Code snippet is too short."),notes:n.Z_8().trim().max(4e3).optional(),makePublic:n.O72().optional()}),u=n.Ryn({userId:i().optional(),value:n.G0j([n.i0J(1),n.i0J(-1),n.i0J(0)]).default(1),storyId:i().optional(),projectId:i().optional(),submissionId:i().optional()}).superRefine((e,t)=>s(t,e));function l(e){return o.parse(e)}function d(e){return a.parse(e)}function m(e){return u.parse(e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972,24,263],()=>r(63485));module.exports=n})();