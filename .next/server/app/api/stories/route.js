"use strict";(()=>{var e={};e.id=655,e.ids=[655],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},15184:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>g,patchFetch:()=>p,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var s={};i.r(s),i.d(s,{GET:()=>d});var r=i(49303),n=i(88716),a=i(60670),u=i(87070),o=i(6961);async function d(e){let{searchParams:t}=new URL(e.url),i=t.get("query")??void 0,s=t.get("university")??void 0,r=t.getAll("tag").filter(Boolean),n=t.get("take"),a=n?Number.parseInt(n,10):void 0,d=await (0,o.r3)({search:i,universitySlug:s,tags:r.length?r:void 0,take:a});return u.NextResponse.json({data:d,meta:{total:d.length}})}let c=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/stories/route",pathname:"/api/stories",filename:"route",bundlePath:"app/api/stories/route"},resolvedPagePath:"C:\\Users\\pc\\OneDrive\\Desktop\\forth.studio\\src\\app\\api\\stories\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:y}=c,g="/api/stories/route";function p(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},6961:(e,t,i)=>{i.d(t,{AV:()=>h,DI:()=>n,E5:()=>a,NT:()=>c,RK:()=>p,VV:()=>m,YH:()=>l,a7:()=>g,g$:()=>d,j4:()=>y,r3:()=>u,rx:()=>o});var s=i(53524),r=i(13538);async function n(){return(await r.Z.problem.findMany({include:{tags:{include:{tag:!0}},submissions:{where:{status:s.SubmissionStatus.PASSED},select:{id:!0}},createdBy:{include:{university:!0}}},orderBy:{createdAt:"desc"}})).map(e=>({slug:e.slug,title:e.title,difficulty:e.difficulty,summary:e.summary,university:e.createdBy?.university?.name??void 0,solved:e.submissions.length,tags:e.tags.map(e=>e.tag.name),updatedAt:e.updatedAt.toISOString()}))}async function a(e){let t=await r.Z.problem.findUnique({where:{slug:e},include:{tags:{include:{tag:!0}},testcases:{orderBy:{isSample:"desc"}},submissions:{where:{status:s.SubmissionStatus.PASSED},select:{id:!0}},createdBy:{include:{university:!0}}}});if(!t)return null;let i=t.testcases.find(e=>e.isSample);return{problem:t,tags:t.tags.map(e=>e.tag.name),sample:i,related:await r.Z.problem.findMany({where:{slug:{not:e},difficulty:t.difficulty},select:{slug:!0,title:!0},take:3})}}async function u(e){let{search:t,universitySlug:i,tags:n,take:a}=e??{},u={status:s.StoryStatus.PUBLISHED};if(t){let e=t.trim();e&&(u.OR=[{title:{contains:e}},{excerpt:{contains:e}},{body:{contains:e}},{tags:{some:{tag:{name:{contains:e}}}}},{author:{OR:[{name:{contains:e}},{username:{contains:e}}]}}])}return i&&(u.university={slug:i}),n?.length&&(u.tags={some:{tag:{name:{in:n}}}}),(await r.Z.story.findMany({where:u,include:{author:!0,university:!0,tags:{include:{tag:!0}}},orderBy:{publishedAt:"desc"},take:a&&a>0?a:void 0})).map(e=>({slug:e.slug,title:e.title,summary:e.excerpt??e.body.slice(0,180),readingTime:e.body.split(/\s+/).length>0?`${Math.max(3,Math.round(e.body.split(/\s+/).length/200))} min read`:"5 min read",university:e.university?.name??"Independent",tags:e.tags.map(e=>e.tag.name)}))}async function o(e){return r.Z.story.findUnique({where:{slug:e,status:s.StoryStatus.PUBLISHED},include:{tags:{include:{tag:!0}},author:{include:{university:!0}},university:!0}})}async function d(){return(await r.Z.project.findMany({include:{owner:!0,university:!0,tags:{include:{tag:!0}},comments:{select:{id:!0}}},orderBy:{createdAt:"desc"}})).map(e=>({slug:e.slug,title:e.title,summary:e.summary,status:e.status,feedbackCount:e.comments.length,author:e.owner.name??e.owner.username,university:e.university?.name??"Independent",tags:e.tags.map(e=>e.tag.name)}))}async function c(e){return r.Z.project.findUnique({where:{slug:e},include:{university:!0,owner:{include:{university:!0}},tags:{include:{tag:!0}},comments:{include:{author:!0},orderBy:{createdAt:"desc"}}}})}async function l(e=6){return(await r.Z.submission.findMany({where:{status:s.SubmissionStatus.PASSED},include:{user:{include:{university:!0}},problem:!0},orderBy:[{score:"desc"},{createdAt:"desc"}],take:e})).map(e=>({id:e.id,title:`${e.problem.title} by ${e.user.name??e.user.username}`,algorithm:e.problem.title,author:e.user.name??e.user.username,university:e.user.university?.name??"Independent",language:e.language,highlights:e.reviewerNote??"Mentor review queued. Highlights will appear once feedback is published.",votes:e.score??0,codeSnippet:e.code}))}async function m(e){return r.Z.submission.findUnique({where:{id:e},include:{user:{include:{university:!0}},problem:!0}})}async function y(){let e=new Date;e.setHours(0,0,0,0);let t=new Date(e);t.setHours(23,59,59,999);let[i,n,a,u]=await Promise.all([r.Z.dailyPick.findFirst({where:{date:{gte:e,lte:t}},include:{problem:{include:{tags:{include:{tag:!0}},submissions:{where:{status:s.SubmissionStatus.PASSED},select:{id:!0}},createdBy:{include:{university:!0}}}}},orderBy:{date:"desc"}}),r.Z.problem.findMany({include:{tags:{include:{tag:!0}},submissions:{where:{status:s.SubmissionStatus.PASSED},select:{id:!0}},createdBy:{include:{university:!0}}},orderBy:{createdAt:"desc"},take:16}),r.Z.story.findMany({where:{status:s.StoryStatus.PUBLISHED},include:{university:!0},orderBy:{publishedAt:"desc"},take:3}),r.Z.project.findMany({include:{university:!0},orderBy:{createdAt:"desc"},take:3})]);return{algorithmOfDay:i?.problem??(0===n.length?null:n[Number(new Date().toISOString().slice(0,10).replace(/-/g,""))%n.length]),campusInsights:a.map(e=>({title:e.title,description:e.university?.name??"forth.studio",tag:"Story",meta:e.publishedAt?e.publishedAt.toLocaleDateString():"Recent",slug:e.slug})),communityCreations:u.map(e=>({title:e.title,description:e.university?.name??"Independent",tag:e.status===s.ProjectStatus.LAUNCHED?"Launched":"Prototype",meta:e.createdAt.toLocaleDateString(),slug:e.slug}))}}async function g(e){let t=(e?await r.Z.user.findUnique({where:{id:e}}):await r.Z.user.findFirst({where:{role:s.Role.STUDENT},orderBy:{createdAt:"asc"}}))??null,[i,n,a,u,o]=await Promise.all([r.Z.submission.count({where:{userId:t?.id,status:s.SubmissionStatus.PASSED}}),r.Z.submission.count({where:{userId:t?.id,createdAt:{gte:new Date(Date.now()-6048e5)}}}),r.Z.comment.count({where:{project:{ownerId:t?.id}}}),r.Z.story.findFirst({where:{authorId:t?.id,status:s.StoryStatus.DRAFT},orderBy:{updatedAt:"desc"}}),r.Z.project.findFirst({where:{ownerId:t?.id},orderBy:{updatedAt:"desc"}})]);return{user:t,stats:{solvedCount:i,weeklySubmissions:n,feedbackCount:a},draftStory:u,latestProject:o,nextProblem:await r.Z.problem.findFirst({orderBy:{createdAt:"desc"},include:{tags:{include:{tag:!0}},createdBy:{include:{university:!0}}}}),featuredStory:await r.Z.story.findFirst({where:{status:s.StoryStatus.PUBLISHED},orderBy:{publishedAt:"desc"}}),topSubmission:await r.Z.submission.findFirst({where:{status:s.SubmissionStatus.PASSED},include:{user:{include:{university:!0}},problem:!0},orderBy:[{score:"desc"},{createdAt:"desc"}]})}}async function p(){return(await r.Z.university.findMany({take:4,orderBy:{createdAt:"asc"}})).map(e=>({name:e.name,headline:e.description??"Active chapter updates coming soon.",impact:`Community members from ${e.city??"campus"} are collaborating on studio challenges.`}))}async function h(){let[e,t]=await Promise.all([r.Z.university.findMany({where:{stories:{some:{status:s.StoryStatus.PUBLISHED}}},select:{id:!0,name:!0,slug:!0},orderBy:{name:"asc"}}),r.Z.tag.findMany({where:{domain:s.TagDomain.STORY},select:{id:!0,name:!0},orderBy:{name:"asc"}})]);return{universities:e,tags:t}}},13538:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(53524);let r=globalThis.prisma??new s.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[948,972],()=>i(15184));module.exports=s})();