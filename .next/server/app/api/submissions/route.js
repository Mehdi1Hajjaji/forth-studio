"use strict";(()=>{var e={};e.id=81,e.ids=[81],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},300:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>S,patchFetch:()=>q,requestAsyncStorage:()=>I,routeModule:()=>x,serverHooks:()=>E,staticGenerationAsyncStorage:()=>v});var r={};s.r(r),s.d(r,{GET:()=>h,POST:()=>w});var i=s(49303),n=s(88716),a=s(60670),o=s(53524),u=s(87070),l=s(13538);let d={"C++":54,"C#":51,Go:95,Java:62,JavaScript:63,Python:92,Rust:73,TypeScript:74},m=new Set([3]),p=new Set([1,2]);async function c(e){let t=process.env.JUDGE0_BASE_URL;if(!t)return null;let s=d[e.language]??null;if(!s)return null;let r=new URL("submissions",t);r.searchParams.set("base64_encoded","false"),r.searchParams.set("wait","true");let i={"Content-Type":"application/json"};process.env.JUDGE0_API_KEY&&(i["X-RapidAPI-Key"]=process.env.JUDGE0_API_KEY),process.env.JUDGE0_API_HOST&&(i["X-RapidAPI-Host"]=process.env.JUDGE0_API_HOST);let n=await fetch(r.toString(),{method:"POST",headers:i,body:JSON.stringify({source_code:e.source,language_id:s,stdin:e.stdin,expected_output:e.expectedOutput})});if(!n.ok)throw Error(`Judge0 request failed with status ${n.status}`);let a=await n.json(),o=a.status?.id??0,u=a.status?.description??"Unknown status";return{status:p.has(o)?"QUEUED":m.has(o)?"COMPLETED":"FAILED",statusId:o,statusDescription:u,stdout:a.stdout,stderr:a.stderr??a.compile_output,time:a.time?Number(a.time):null,memory:a.memory?Number(a.memory):null,token:a.token}}var f=s(1184),g=s(95456),b=s(96263);function y(e,t=400,s){return u.NextResponse.json({error:e,details:s},{status:t})}async function h(e){let{searchParams:t}=new URL(e.url),s=t.get("userId"),r=t.get("problemSlug"),i=Number.parseInt(t.get("limit")??"",10),n={};s&&(n.userId=s),r&&(n.problem={slug:r});let a=await l.Z.submission.findMany({where:n,include:{user:{select:{id:!0,username:!0,name:!0,avatarUrl:!0}},problem:{select:{id:!0,slug:!0,title:!0,difficulty:!0}}},orderBy:{createdAt:"desc"},take:Number.isFinite(i)?Math.min(Math.max(i,1),100):25});return u.NextResponse.json({data:a,meta:{total:a.length}})}async function w(e){let t;try{let s=await e.json();t=(0,f.Wi)(s)}catch(e){if(e instanceof b.jmq)return y("Invalid submission payload.",422,e.flatten());return y("Malformed JSON body.")}let s=await (0,g.ts)(),r=t.userId??s?.id??null;if(!r)return y("Authentication required.",401);if(t.userId&&s?.id&&t.userId!==s.id)return y("You cannot submit solutions for another user.",403);let[i,n]=await Promise.all([l.Z.user.findUnique({where:{id:r}}),l.Z.problem.findUnique({where:{slug:t.problemSlug},include:{testcases:{where:{isSample:!0},take:1}}})]);if(!i)return y("User not found.",404);if(!n)return y("Problem not found.",404);try{let e=await l.Z.submission.create({data:{userId:r,problemId:n.id,language:t.language,code:t.code,status:o.SubmissionStatus.QUEUED},include:{user:{select:{id:!0,username:!0,name:!0,avatarUrl:!0}},problem:{select:{id:!0,slug:!0,title:!0,difficulty:!0}}}}),s=n.testcases[0],i=null;try{i=await c({language:t.language,source:t.code,stdin:s?.input,expectedOutput:s?.output})}catch(e){console.error("Judge0 evaluation failed:",e)}if(i){let t={status:"COMPLETED"===i.status?o.SubmissionStatus.PASSED:"FAILED"===i.status?o.SubmissionStatus.FAILED:o.SubmissionStatus.RUNNING,runtimeMs:"number"==typeof i.time?Math.round(1e3*i.time):null,memoryKb:"number"==typeof i.memory?i.memory:null,score:"COMPLETED"===i.status?1:0};await l.Z.submission.update({where:{id:e.id},data:t})}let a=await l.Z.submission.findUnique({where:{id:e.id},include:{user:{select:{id:!0,username:!0,name:!0,avatarUrl:!0}},problem:{select:{id:!0,slug:!0,title:!0,difficulty:!0}}}});return u.NextResponse.json({data:a,meta:{evaluation:i}},{status:201})}catch(e){if(e instanceof o.Prisma.PrismaClientKnownRequestError)return y(e.message,400);throw e}}let x=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/submissions/route",pathname:"/api/submissions",filename:"route",bundlePath:"app/api/submissions/route"},resolvedPagePath:"C:\\Users\\pc\\OneDrive\\Desktop\\forth.studio\\src\\app\\api\\submissions\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:I,staticGenerationAsyncStorage:v,serverHooks:E}=x,S="/api/submissions/route";function q(){return(0,a.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:v})}},95456:(e,t,s)=>{s.d(t,{Lz:()=>u,ts:()=>d}),s(6113);var r=s(13539),i=s(53797),n=s(98691),a=s(75571),o=s(13538);let u={adapter:(0,r.N)(o.Z),session:{strategy:"database"},secret:function(){let e=process.env.NEXTAUTH_SECRET;if(!e)throw Error("NEXTAUTH_SECRET is required in production environments.");return e}(),pages:{signIn:"/auth/sign-in"},providers:[(0,i.Z)({name:"Email and password",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e.password)return null;let t=await o.Z.user.findUnique({where:{email:e.email.toLowerCase()}});return t&&await (0,n.qu)(e.password,t.hashedPassword)?{id:t.id,email:t.email,name:t.name??t.username,image:t.avatarUrl??null}:null}})],callbacks:{async session({session:e,user:t}){if(!e.user)return e;let s=t??(e.user.email?await o.Z.user.findUnique({where:{email:e.user.email.toLowerCase()},select:{id:!0,name:!0,username:!0,email:!0,avatarUrl:!0}}):null);return s&&(e.user={...e.user,id:s.id}),e}}};async function l(){return(0,a.getServerSession)(u)}async function d(){let e=await l();return e?.user??null}},13538:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(53524);let i=globalThis.prisma??new r.PrismaClient({log:["error"]})},1184:(e,t,s)=>{s.d(t,{Kl:()=>l,VO:()=>m,Wi:()=>d});var r=s(96263);let i=()=>r.Z_8().cuid({message:"Invalid identifier"});function n(e,t){let s=[t.storyId?"storyId":null,t.projectId?"projectId":null,t.submissionId?"submissionId":null].filter(Boolean);0===s.length?e.addIssue({code:r.NLt.custom,message:"Specify exactly one target resource."}):s.length>1&&e.addIssue({code:r.NLt.custom,message:`Multiple targets provided (${s.join(", ")}). Select only one.`})}let a=r.Ryn({authorId:i().optional(),body:r.Z_8().trim().min(3,"Comment is too short.").max(2e3),storyId:i().optional(),projectId:i().optional(),submissionId:i().optional()}).superRefine((e,t)=>n(t,e)),o=r.Ryn({userId:i().optional(),problemSlug:r.Z_8().trim().min(1,"Problem slug is required."),language:r.Z_8().trim().min(1,"Language is required."),code:r.Z_8().min(10,"Code snippet is too short."),notes:r.Z_8().trim().max(4e3).optional(),makePublic:r.O72().optional()}),u=r.Ryn({userId:i().optional(),value:r.G0j([r.i0J(1),r.i0J(-1),r.i0J(0)]).default(1),storyId:i().optional(),projectId:i().optional(),submissionId:i().optional()}).superRefine((e,t)=>n(t,e));function l(e){return a.parse(e)}function d(e){return o.parse(e)}function m(e){return u.parse(e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972,24,263],()=>s(300));module.exports=r})();